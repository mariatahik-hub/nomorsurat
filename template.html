<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="UTF-8">
    <title>Kode Klasifikasi Surat</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <style>
      :root {
        --color-bg: #f3f4f6;               /* grey */
        --color-sidebar-bg: #111827;       /* light black / very dark grey */
        --color-sidebar-border: #1f2937;
        --color-primary: #14b8a6;          /* teal */
        --color-primary-soft: #e5fffb;     /* light aqua-ish */
        --color-text-main: #111827;
        --color-text-muted: #6b7280;
        --color-white: #ffffff;
        --color-border-soft: #e5e7eb;
        --shadow-soft: 0 10px 25px rgba(15, 23, 42, 0.12);
        --radius-lg: 1.25rem;
        --radius-md: 0.75rem;
        --transition-fast: 0.18s ease-out;
      }

      * {
        box-sizing: border-box;
      }

      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
      }

      body {
        font-family: 'Poppins', 'Roboto', 'Montserrat', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: var(--color-bg);
        color: var(--color-text-main);
      }

      .app-shell {
        display: flex;
        min-height: 100vh;
      }

      /***************
       * SIDEBAR     *
       ***************/
      .sidebar {
        width: 260px;
        background: var(--color-sidebar-bg);
        color: var(--color-white);
        padding: 1.5rem 1.25rem;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        border-right: 1px solid var(--color-sidebar-border);
        position: relative;
      }

      .sidebar-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .sidebar-logo {
        width: 40px;
        height: 40px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 30%, #5eead4, #0f766e);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 10px 20px rgba(20, 184, 166, 0.4);
      }

      .sidebar-logo i {
        color: var(--color-white);
        font-size: 1.2rem;
      }

      .sidebar-title {
        display: flex;
        flex-direction: column;
        gap: 0.2rem;
      }

      .sidebar-title h1 {
        margin: 0;
        font-size: 1.05rem;
        font-weight: 600;
        letter-spacing: 0.02em;
      }

      .sidebar-title span {
        font-size: 0.75rem;
        color: #9ca3af;
      }

      .nav-section-title {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: #9ca3af;
        margin-bottom: 0.35rem;
      }

      .nav {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
      }

      .nav-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.55rem 0.75rem;
        border-radius: 999px;
        text-decoration: none;
        color: #e5e7eb;
        font-size: 0.85rem;
        font-weight: 500;
        transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
      }

      .nav-item i {
        width: 20px;
        text-align: center;
        font-size: 0.95rem;
      }

      .nav-item span {
        flex: 1;
      }

      .nav-item .nav-tag {
        font-size: 0.7rem;
        padding: 0.1rem 0.55rem;
        border-radius: 999px;
        background: rgba(148, 163, 184, 0.18);
        color: #e5e7eb;
      }

      .nav-item:hover {
        background: rgba(148, 163, 184, 0.15);
        transform: translateX(2px);
      }

      .nav-item.active {
        background: linear-gradient(135deg, #14b8a6, #06b6d4);
        color: var(--color-white);
        box-shadow: 0 0 0 1px rgba(45, 212, 191, 0.3), 0 10px 20px rgba(15, 118, 110, 0.5);
      }

      .nav-item.active .nav-tag {
        background: rgba(15, 23, 42, 0.3);
      }

      .sidebar-footer {
        margin-top: auto;
        font-size: 0.75rem;
        color: #9ca3af;
        border-top: 1px solid #1f2937;
        padding-top: 0.75rem;
      }

      .sidebar-footer .pill {
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
        background: rgba(15, 23, 42, 0.9);
        padding: 0.3rem 0.6rem;
        border-radius: 999px;
        border: 1px solid #1f2937;
        margin-top: 0.35rem;
      }

      .sidebar-footer i {
        font-size: 0.7rem;
      }

      /***************
       * MAIN AREA   *
       ***************/
      .main {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-width: 0;
      }

      /***************
       * TOP BAR     *
       ***************/
      .topbar {
        height: 60px;
        background: var(--color-white);
        border-bottom: 1px solid var(--color-border-soft);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 1.75rem;
        box-shadow: 0 4px 10px rgba(15, 23, 42, 0.04);
        position: sticky;
        top: 0;
        z-index: 10;
      }

      .topbar-left {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .topbar-left .menu-toggle {
        display: none;
        border: none;
        background: transparent;
        cursor: pointer;
        font-size: 1.2rem;
        color: var(--color-text-main);
      }

      .topbar-title {
        font-size: 0.95rem;
        font-weight: 500;
        color: var(--color-text-muted);
      }

      .topbar-title span {
        font-weight: 600;
        color: var(--color-primary);
      }

      .topbar-right {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .chip {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.2rem 0.75rem;
        border-radius: 999px;
        border: 1px solid var(--color-border-soft);
        background: #f9fafb;
        font-size: 0.75rem;
        color: var(--color-text-muted);
      }

      .chip i {
        font-size: 0.8rem;
        color: var(--color-primary);
      }

      .topbar-button {
        border-radius: 999px;
        border: 1px solid transparent;
        background: var(--color-primary-soft);
        padding: 0.45rem 0.9rem;
        display: inline-flex;
        align-items: center;
        gap: 0.45rem;
        font-size: 0.8rem;
        cursor: pointer;
        color: #0f766e;
        font-weight: 500;
        transition: background var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast);
      }

      .topbar-button i {
        font-size: 0.9rem;
      }

      .topbar-button:hover {
        background: #ccfbf1;
        box-shadow: 0 6px 16px rgba(13, 148, 136, 0.3);
        transform: translateY(-1px);
      }

      /***************
       * CONTENT     *
       ***************/
      .content-wrapper {
        padding: 1.5rem 1.75rem 2rem;
      }

      .content-card {
        background: var(--color-white);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        box-shadow: var(--shadow-soft);
        border: 1px solid rgba(148, 163, 184, 0.25);
        min-height: calc(100vh - 60px - 3rem);
      }

      .content-card-header {
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
      }

      .content-card-header-title {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
      }

      .content-card-header-title h2 {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .content-card-header-title h2 i {
        font-size: 1rem;
        color: var(--color-primary);
      }

      .content-card-header-title p {
        margin: 0;
        font-size: 0.8rem;
        color: var(--color-text-muted);
      }

      .content-card-badge {
        font-size: 0.73rem;
        padding: 0.25rem 0.7rem;
        border-radius: 999px;
        background: var(--color-primary-soft);
        color: #0f766e;
        border: 1px solid rgba(45, 212, 191, 0.65);
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
      }

      .content-card-badge i {
        font-size: 0.85rem;
      }

      /* Area untuk menyisipkan halaman lain (cari, history, dll.) */
      #page-content {
        margin-top: 1rem;
      }

      /********************
       * RESPONSIVE       *
       ********************/
      @media (max-width: 960px) {
        .sidebar {
          position: fixed;
          inset: 0 auto 0 0;
          transform: translateX(-100%);
          transition: transform var(--transition-fast);
          z-index: 20;
        }

        .sidebar.open {
          transform: translateX(0);
          box-shadow: 20px 0 40px rgba(15, 23, 42, 0.4);
        }

        .main {
          flex: 1;
        }

        .topbar-left .menu-toggle {
          display: inline-flex;
        }

        .content-wrapper {
          padding: 1rem 1rem 1.5rem;
        }

        .content-card {
          padding: 1.1rem;
          border-radius: 1rem;
        }
      }

      @media (max-width: 640px) {
        .topbar-right {
          display: none;
        }
      }
    </style>
  </head>

  <body>
    <div class="app-shell">
      <!-- SIDEBAR -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <div class="sidebar-logo">
            <i class="fa-solid fa-folder-open"></i>
          </div>
          <div class="sidebar-title">
            <h1>Kode Klasifikasi Surat</h1>
            <span>Dinas Pendidikan &amp; Kebudayaan</span>
          </div>
        </div>

        <div>
          <div class="nav-section-title">Menu Umum</div>
          <nav class="nav">
            <!-- Cari -->
            <a href="<?!= getScriptUrl() ?>?page=cari"
               class="nav-item <?!= currentPage === 'cari' ? 'active' : '' ?>">
              <i class="fa-solid fa-magnifying-glass"></i>
              <span>Cari Kode</span>
            </a>

            <!-- History -->
            <a href="<?!= getScriptUrl() ?>?page=history"
               class="nav-item <?!= currentPage === 'history' ? 'active' : '' ?>">
              <i class="fa-solid fa-clock-rotate-left"></i>
              <span>History Pencarian</span>
            </a>

        
            <!-- Login -->
            <!--<a href="<?!= getScriptUrl() ?>?page=login"
               class="nav-item <?!= currentPage === 'login' ? 'active' : '' ?>">
              <i class="fa-solid fa-right-to-bracket"></i>
              <span>Login</span>
            </a>-->
          </nav>
        </div>
        

        <!-- Hanya admin -->
        <? if (isAdmin) { ?>
        <div>
          <div class="nav-section-title">Menu Admin</div>
          <nav class="nav">
            <!-- Database -->
            <a href="<?!= getScriptUrl() ?>?page=database"
               class="nav-item <?!= currentPage === 'database' ? 'active' : '' ?>">
              <i class="fa-solid fa-database"></i>
              <span>Database Kode</span>
              <span class="nav-tag">CRUD</span>
            </a>

            <!-- Ringkasan -->
            <a href="<?!= getScriptUrl() ?>?page=ringkasan"
               class="nav-item <?!= currentPage === 'ringkasan' ? 'active' : '' ?>">
              <i class="fa-solid fa-chart-line"></i>
              <span>Ringkasan</span>
              <span class="nav-tag">Statistik</span>
            </a>
          </nav>
        </div>
        <? } ?>

        <div class="sidebar-footer">
          <div>Mode: <strong><?!= isAdmin ? 'Admin' : 'User Biasa' ?></strong></div>
          <? if (userEmail) { ?>
          <div class="pill">
            <i class="fa-solid fa-user"></i>
            <span><?!= userEmail ?></span>
          </div>
          <? } else { ?>
          <div class="pill">
            <i class="fa-solid fa-circle-info"></i>
            <span>Belum terdeteksi akun (web app publik)</span>
          </div>
          <? } ?>
        </div>
      </aside>

      <!-- MAIN -->
      <div class="main">
        <!-- TOP BAR -->
        <header class="topbar">
          <div class="topbar-left">
            <button class="menu-toggle" id="menuToggle" aria-label="Toggle sidebar">
              <i class="fa-solid fa-bars"></i>
            </button>
            <div class="topbar-title">
              Sistem Pencarian <span>Kode Klasifikasi Surat</span>
            </div>
          </div>

          <div class="topbar-right">
            <div class="chip">
              <i class="fa-solid fa-bolt"></i>
              <span>Google Sheets &amp; Apps Script</span>
            </div>
            <button class="topbar-button" type="button" id="helpButton">
              <i class="fa-regular fa-circle-question"></i>
              <span>Bantuan</span>
            </button>
          </div>
        </header>

        <!-- CONTENT -->
        <div class="content-wrapper">
          <div class="content-card">
            <div class="content-card-header">
              <div class="content-card-header-title">
                <h2>
                  <i class="fa-solid fa-layer-group"></i>
                  <span id="pageTitleText">Modul Kode Klasifikasi</span>
                </h2>
                <p id="pageSubtitleText">
                  Pilih menu di samping untuk mulai mencari kode klasifikasi surat atau mengelola database (khusus admin).
                </p>
              </div>
              <div class="content-card-badge">
                <i class="fa-solid fa-circle-check"></i>
                <span>Template aktif</span>
              </div>
            </div>

            <!-- Di sinilah file HTML lain disisipkan -->
            <div id="page-content">
              <?!= include(contentTemplate) ?>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      (function () {
        'use strict';

        // Informasi halaman saat ini dari server-side template
        const CURRENT_PAGE = '<?!= currentPage ?>';
        const IS_ADMIN     = <?!= isAdmin ? 'true' : 'false' ?>;

        const sidebar    = document.getElementById('sidebar');
        const menuToggle = document.getElementById('menuToggle');
        const helpButton = document.getElementById('helpButton');
        const pageTitle  = document.getElementById('pageTitleText');
        const pageSub    = document.getElementById('pageSubtitleText');

        // Toggle sidebar untuk tampilan mobile
        if (menuToggle && sidebar) {
          menuToggle.addEventListener('click', function () {
            sidebar.classList.toggle('open');
          });
        }

        // Tutup sidebar jika klik di luar (mobile)
        document.addEventListener('click', function (e) {
          if (!sidebar) return;
          const isClickInsideSidebar = sidebar.contains(e.target);
          const isClickMenuToggle = menuToggle && menuToggle.contains(e.target);

          if (!isClickInsideSidebar && !isClickMenuToggle && sidebar.classList.contains('open')) {
            sidebar.classList.remove('open');
          }
        });

        // Tombol bantuan
        if (helpButton) {
          helpButton.addEventListener('click', function () {
            const message = [
              'Tips Penggunaan:',
              '',
              '1. Gunakan menu "Cari Kode" untuk mencari kode klasifikasi surat berdasarkan kata kunci.',
              '2. Menu "History Pencarian" menampilkan riwayat kode yang sering dicari.',
              '3. Menu "Database Kode" dan "Ringkasan" hanya tersedia untuk admin.',
              '4. Semua data disimpan dan dibaca dari Spreadsheet "Nomor Surat".'
            ].join('\n');
            alert(message);
          });
        }

        // Set judul & deskripsi dinamis berdasarkan halaman
        const pageMeta = {
          'cari': {
            title: 'Pencarian Kode Klasifikasi',
            subtitle: 'Pastikan pencarian kode klasifikasi surat berdasarkan PERIHAL bukan berdasarkan jenis surat.'
          },
          'history': {
            title: 'History Pencarian Kode',
            subtitle: 'Lihat daftar kode klasifikasi yang paling sering dicari oleh pengguna lain.'
          },
          'login': {
            title: 'Status User',
            subtitle: 'Masuk sebagai admin untuk mengelola database kode klasifikasi dan melihat ringkasan statistik.'
          },
          'database': {
            title: 'Database Kode Klasifikasi (Admin)',
            subtitle: 'Kelola data kode klasifikasi surat: tambah, ubah, hapus, dan lihat daftar lengkap.'
          },
          'ringkasan': {
            title: 'Ringkasan Pencarian (Admin)',
            subtitle: 'Pantau ringkasan pencarian kode klasifikasi per hari dan per bulan.'
          },
          'dashboard': {
            title: 'Dashboard',
            subtitle: 'Ringkasan singkat aktivitas pencarian kode klasifikasi surat.'
          }
        };

        if (pageMeta[CURRENT_PAGE]) {
          if (pageTitle)  pageTitle.textContent  = pageMeta[CURRENT_PAGE].title;
          if (pageSub)    pageSub.textContent    = pageMeta[CURRENT_PAGE].subtitle;
        }

        // Jika user bukan admin tapi somehow buka page admin via URL, berikan peringatan sederhana (front-end only)
        if (!IS_ADMIN && (CURRENT_PAGE === 'database' || CURRENT_PAGE === 'ringkasan')) {
          const content = document.getElementById('page-content');
          if (content) {
            content.innerHTML = `
              <div style="
                padding: 1.25rem;
                border-radius: 0.9rem;
                border: 1px solid rgba(248, 113, 113, 0.4);
                background: #fef2f2;
                color: #991b1b;
                display: flex;
                gap: 0.75rem;
                align-items: flex-start;
              ">
                <i class="fa-solid fa-triangle-exclamation" style="margin-top: 0.15rem;"></i>
                <div>
                  <strong>Akses dibatasi.</strong>
                  <div style="font-size: 0.85rem; margin-top: 0.25rem;">
                    Halaman ini hanya dapat diakses oleh admin. Silakan kembali ke menu <b>Cari Kode</b> atau
                    <b>History Pencarian</b>. Jika Anda seharusnya memiliki akses admin, hubungi pengelola sistem.
                  </div>
                </div>
              </div>
            `;
          }
        }
      })();
    </script>
  </body>
</html>
